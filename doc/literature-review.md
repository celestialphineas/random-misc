# 文献综述

## 背景介绍

微生物基因组测序可以增进人们对生物和医药问题的理解。微生物基因组研究可以实现以下任务：计算自然环境中样品的细菌丰度、从中发现新细菌 {{Yu 2017}}，重建人体微生物的组成、揭示其与生活方式间的关联 {{Pasolli 2019}} 等。这些新方法和工具可以揭示出微生物群落与环境的联系{{Yu 2017, Seeleuthner 2018}}，以及与人体健康的联系{{Galkin 2018, Pasolli 2019}}。这些研究无不需要第二代基因测序的应用，而这一方法既面临着生物学方面的挑战，也面临着计算上的技术难题 {{Gawad 2015}}。

微生物基因组研究依主体可分为两种：(a) 宏基因组（metagenome）：研究环境中的微生物群落的基因组 {{Tringe 2005}}；(b) 单细胞（single-cell）：研究分离开来的单独细胞或物种的基因组 {{Gawad 2015, Tringe 2005}}。

这两种类型在现代的测序技术下都会产生海量的数据。我们需要使用组合数学和数据科学中的算法，才能更加有效高效地利用这些数据。

### 生物学背景

#### DNA和基因组

**DNA（deoxyribonucleic acid，脱氧核糖核酸）**是一种生物大分子，由两条链构成了双螺旋结构。DNA分子的每条链都是由核苷酸构成的长序列，其中一端称为5’端，另一端称为3’端。两条链的方向是相反的。核苷酸共有4种，它们的碱基不同（A、C、G、T）。DNA分子的两条链根据碱基配对原则互补（A对T，C对G）。DNA上面编码了遗传信息。

DNA上编码蛋白质的特定片段称为这一蛋白质的**基因**。“基因”一词也用以描述DNA分子上的非编码控制区域。**基因组**（genome）是某一生物个体的DNA分子上遗传信息的总和。{{Understanding Bioinformatics}}

#### 二代测序

使用DNA测序技术我们可以知道DNA上的核苷酸序列。最早的DNA测序技术可追溯到1970年代，典型的方法是桑格测序。从1990年代中期，一些新的测序方法出现了，这些测序方法被称为“下一代测序”或“二代测序”。

DNA测序方法并非一次将整个基因组测出，而是每次只能测出DNA分子中各部分的序列。输出的长度取决于方法。单个输出序列在这一语境下叫做一**读（read）**。

读长和每轮读数是衡量一个测序方法的两个重要指标。Illumina商用化了一种高通量的测序方法，最高可达平均300 bp（base-pair，碱基对）的读长，每轮约10^9^读的通量 {{Hodkinson 2014}}。在研究中我们会使用Illumina *de novo*（从头，没有任何已知的序列作为测序参考）测序方法。

扩增过程对单个分子而言是必要的，可以增强放射或荧光标记的强度。信号会由数字图像记录下来，每个点都是一个DNA分子簇，对应于一个DNA片段。测序结果可以从一系列的图像中推断出来。

然后得到的读将会被加以分析处理。常见的任务有将较短的读**组装（assembly）**成更长的**连续片段（contig, contiguous sequence）**，**对齐（align）**到已知的基因组，将contig**装箱（bin）**分类到种的级别等。{{An introduction to Next-Generation Sequencing Technology}} 这些任务都需要计算工作，我们将在后文讨论。

### 当前的微生物基因组研究方法

#### 宏基因组

微生物基因组研究的宏基因组法是对环境或人工样品中微生物群落的混合细胞做测序的方法{{Yu 2017}}。下图为一典型宏基因组研究的流程：

#### 单细胞

单细胞研究的样品和宏基因组研究或许并无太大差距，但单细胞方法会将细胞分离并对全基因组做扩增 {{Gawad 2015}}。

### 关于计算

二代测序的数据处理需要用到数据科学中的方法。这一节会归纳一些数据本身的特性、数据会受到何种处理、这些处理怎么做、其中的计算挑战又有哪些。

#### 输入数据的特性

* 读是由字符A、C、G和T构成的字符串。
* 读与读之间可能会有重叠，这些重叠的信息可以帮助我们做组装，即将短片段拼成长片段。
* 读与读之间所在的DNA链可能是不同侧的。例如一个DNA分子链的序列是ACCGGGTTTT，那么在相反互补链上的序列就会是AAAACCCGGT {{参见：生物学背景/DNA和基因组}}。如果你的读长是5，你可能会在测序结果中看到ACCGG和AAAAC这样的序列。
* 读并非总是和参考序列或期望的基因组的一个字串完全一致，因为在DNA分子的复制和扩增中可能出现错误，测序过程也并非完全准确。
* 每个核苷酸的测序质量都有记录。详情可参考FASTQ文件格式定义。{{Cock 2010}}
* 在宏基因组研究中，同一轮（也在同一文件中）测序的读来自不同细胞，这也是为什么会有分类问题以及为什么组装会难。
* 在单细胞研究中，同一轮的读应该都来自于单个细胞的DNA，但仍会有污染情况发生。

#### 组装（Assembly）

组装是将DNA测序得到的读拼接成更长序列的过程，组装的结果称为contig（contiguous segments，连续片段）。组装过程的输入是一个DNA序列的集合，其中每个片段之间可能会有所重叠。我们所期望的输出是一个更长DNA序列的集合，其中的每个都包含有某些输入序列。为实现这一目标，主要有两种方法。其一是overlay layout consensus (OCL)，也是比较早的方法。另一是基于de Bruijn图。基于de Bruijn图的组装方法也是当前最为常用的。

暂不考虑校错环节以及两个方法中导致无法得出更为连续结果的信息缺失，对组装问题的形式化描述有一个非常直观的问题，即最短公超串问题（shortest common superstring, SCS）。SCS问题可以被很容易地规约到一个旅行商问题（traveling salesman problem, TSP），因此这是一个NP完全问题。这一规约的第一步就是将SCS问题转换为一个图论问题，这也有助于近似算法的设计。因为组装结果并没有必要是输入读的SCS，近似是可以接受的，通常在OLC算法中，都采取贪婪策略。



然而，计算所有输入串的重叠开销巨大，这使得OLC效率不够高。De Bruijn图方法并不解决SCS问题，但在计算上效率很高，对于拼接输入串而言，性能已经足够好。我们首先将所有输入串截至长度$k$，每个这样的子串叫一个$k$-mer。De Bruijn图的构造是使所有$k$-mer成为图上的节点（相同的$k$-mer在图上是被合并的），对每个$k$-mer，构造一条从自身至相邻接$k$-mer的有向边。



每个输入串的De Bruijn图都被合并在一起。输入串拼接得到的超串（严格来说不一定是超串）可以通过构造图上的一条欧拉路径得到。{{Course: Foundations of Computational and Systems Biology}}

当前大多主流的DNA组装器都基于de Bruijn图，但很多都会在原始算法上加修改。例如，SPAdes组装器使用了基于多尺寸de Bruijin图（multisized de Bruijn graph，$k$-mer中的$k$选取多个数值）的四阶段算法，该算法在单细胞数据中可以表现得更好。{{Bankevich, 2012}}

#### 对齐（Alignment）

读会被对齐到contig、scaffold或是已知基因组上。对齐对于后续分析尤为重要，例如，估算DNA片段在样品间的丰度。

因为读并不一定和参考序列的某个字串完全一致，对齐也不是通过在参考序列上做精确查找完成的，而是通过相似度查找完成。{{Understanding Bioinformatics}}

#### 装箱（Binning）

单个样品的测序数据相比整个基因组并不高，将来自不同样品的contig聚合在一起可以让我们更有效地使用测序数据。属于同种细胞的contig可能来自同一样品或不同样品。而装箱就是将相似的DNA片段按物种层级分类。

我们如何获知contig来自同一物种呢？这一信息既可以从片段在样品间丰度的模式发现，又可以从片段本身的性质得出。MetaBAT是做装箱的有效工具，它提出并实现了一种做contig分类的崭新方法。在MetaBAT之前，大多数装箱都是无监督完成的，例如通过对序列丰度或特征做聚类。然而对MetaBAT来说，序列相似度是通过一个概率模型评估的。两个contig来自相同细胞的概率由一个朴素贝叶斯分类器预测，而这个分类器由数据训练。MetaBAT后续的装箱过程仍然是无监督的聚类方法。{{Kang 2015}}

大多数装箱工具都使用$k$-mer的频率统计作为特征提取或选择的方式。{{Sczyrba 2017}} 装箱也需要不同的降维技巧来使得分类或聚类效率更高，或使得可视化变为可能。

#### 其他

根据课题的不同也有很多其他的分析过程或方法，这里我们不再多加叙述。

## 研究现状

本文的读者应该来自计算背景而非生物背景，因此下文所述研究中的生物学故事将被忽略。我们会将笔墨主要放在方法上，方法的输入输出，方法间的对比，以及宏基因组和单细胞方法所面临的挑战和限制。

### 宏基因组

我们已经在前文描述了微生物基因组的宏基因组方法的大致流程，这里我们将列出若干宏基因组研究以及它们的主要方法。典型的宏基因组研究使用未经细胞分离的样品，但仍有一部分研究使用的方法更接近于单细胞方法，每份样品中的细胞数目被控制在了一个较小的量级。

| 论文            | 样品数                               | 每份样品中的细胞数 | 读数                        | 用于数据处理的最短contig长度 | 发现的基因组数                       | 备注                                                         | 工具                                                         |
| --------------- | ------------------------------------ | ------------------ | --------------------------- | ---------------------------- | ------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Yu等，2017      | 2 （1号样品有48个子样品，2号有93个） | 每个子样品约10个   | 2.54亿（成对，1.21 + 2.33） | > 10 kbp                     | 提取出了29个，大多数是新的           | 使用了多重置换扩增（Multiple Displacement Amplification， MDA），这在宏基因组方法中并不多见 | DNACCLUST（聚类）、SPAdes（组装）、Bowtie2（对齐）           |
| Stewart等，2018 | 42个宏基因组样品                     | 原始样品           | 1.396亿（成对）             | > 2 kbp                      | 913（90%预测的蛋白质没有很好的对应） | Hi-C-based proximity-guided assembly is used                 | MEGAHIT（组装）、BWA MEM（对齐）、Kraken（分类）、MetaBAT（装箱） |
| Pasolli等，2019 | 9,428                                | 原始样品           | 4.1e11                      | > 1 kbp                      | > 150,000（4,930个物种，77%未知）    |                                                              | metaSPAdes（成对组装）、MEGAHIT（非成对组装）、MetaBAT（装箱） |

#### 存在的问题

和单细胞方法相比，宏基因组方法的操作更为简单直接，不需要分离细胞。然而，因为来自不同细胞的序列混合在一起，宏基因组面临的主要问题是区分序列和细胞。尽管这一大批量的方法已经能够做到发现新物种，大多数的宏基因组方法研究都是在生态系统或群落层级的。{{Gawad 2016}}

### 单细胞

单细胞研究通常涉及分离细胞和全基因组扩增（whole-genome amplification，通常采用多重置换扩增，multiple displacement amplification, MDA）。在微生物领域中，单细胞方法相比宏基因组方法用得少。综述{{Gawad 2016}}记录了大量单细胞方法文献，列出并分类了它们的贡献。下面列出了若干更为近期的研究。这些研究更加倾向于实验的改进，而非计算方法。


| 论文                | 细胞数                   | 读数             | 备注                                                         | 工具                          |
| ------------------- | ------------------------ | ---------------- | ------------------------------------------------------------ | ----------------------------- |
| Xu等，2016          | 421                      | 70万/样          | 使用了凝胶内的数字多重置换扩增（in-gel digital multiple displacement amplification，dMDA），相对液体中的MDA，chimerism现象少了很多 | 未提及                        |
| Lan等，2017         | 通量可达每轮50,000多细胞 | 约1500万（单端） | 利用液滴条码技术（microfluidic droplet barcoding technique）的超高通量测序 | Bowtie2、Kraken               |
| Seeleuthner等，2018 | 约10^4^                  | 约2500万（成对） | 放大了超过900种单细胞基因组                                  | HyDA（组装）、Bowtie2（对齐） |

#### 存在的问题

单细胞方法使我们可以从细胞层面上去研究微生物群落，它相比于宏基因组方法可以提供更多的信息。

分离细胞和全基因组扩增是两大主要特征，但也提出了挑战。前者对实验设计提出了更高要求，当前，微流控方法可以解决这些问题。

扩增全基因组通常使用MDA，但是MDA会有chimera现象以及DNA分子上的选择性偏斜（bias）。这会导致读的错误，以及读在DNA分子上的不均匀分布。这些问题会给数据的处理和分析带来问题。

### 工具

下面我们列出一部分流行的生物信息学工具，它们的方法很具有启发性。

#### MetaBAT

MetaBAT是用于宏基因组研究的DNA片段装箱工具。它可以将相似的contig聚为一类，将他们装到物种层级的箱中去。

MetaBAT利用两个概率模型来预测两个contig之间的相似度，这一相似度会被用作聚类的距离。contig之间的相似度通过两方面度量，其一是序列本身的相似程度，其二是它们在样品中的分布。

序列的相似度通过四核苷酸频率概率距离（tetranucleotide frequency probability distance, TDP）衡量。四核苷酸频率（tetranucleotide frequency, TNF）是定义在DNA序列上的一个统计值，是对这个序列上所有邻接4-mer的一个统计。MetaBAT引入了TDP，即两个contig来自同一物种的概率。这个概率通过一个朴素贝叶斯分类器计算，训练集的数据来自公共数据库。

contig在样品间的分布也被使用，这一部分被称为丰度距离概率（abundance distance probability, ADP）。ADP的计算假设了contig在样品间的分布服从正态分布，两个contig之间的ADP则是它们所对应的正态分布的差值的积分。{{Kang 2015}}

#### Kraken

Kraken是宏基因组DNA片段分类器。在给出一系列基因组作为参考序列的情况下，Kraken可以预测某一片段所来自的物种。

为使得Kraken可以正常运行，首先需要建立一个分类树，和一个$k$-mer与树上节点之间的查找表。Kraken会先依据已知基因组的参考序列建立分类树，然后它会计算并统计每个基因组中出现的所有$k$-mer。对每个出现的$k$-mer，Kraken在分类树种找出拥有这一$k$-mer的所有物种的最近共有祖先（lowest common ancestor, LCA），并将这个节点记录在查找表中。

为了确定每次查询序列所对应的物种，我们将查询序列中的所有$k$-mer作以统计。随后，我们将统计的结果根据查找表记录在分类树的对应节点上。查找操作就是在被分配了点权的分类树上计算最大的根到叶路径（root-to-leaf path），叶子节点对应的物种就是这次查找的结果。

Kraken为了达到更好的性能也引入了一些有趣的计算技巧，它定义了序列的典则形式（canonical form），以及序列的$M$-mer最小化（$M$-mer minimizer）等概念。这些数学和计算技巧指导了查找表的实际设计，可以让内存足迹尽可能小，缓存装载开销也由此降低。{{Wood 2014}}

## 研究展望

在生物信息学中，从组合优化到深度学习{{Galkin 2018}}的各种高级算法都已经被应用于其中。实现精巧的工具和优化到硬件层面的方法也十分多见。但在这些方法之上仍然有潜在的改进余地，例如对测序数据的降维，就涉及了对DNA串的特征提取和选择的技巧。

微生物群落基因组研究中的单细胞方法相比宏基因组方法仍然较为稀少。相比于宏基因组方法天然样本的复杂度在单细胞研究中被转化为了大量的单独细胞的数据。这在提供给我们新的信息的同时也提出了更多挑战。我们需要新的处理数据的方法，特别是选取做协同组装（co-assembly）的细胞的策略。这需要处理数据的崭新方法。

尽管在DNA测序数据处理的各个环节已经有了很多工具，工作流程的设计和自定义工具的开发仍然需要计算机科学与技术的工作。从科学角度而言，最为重要的是方法的输出。但这并不意味着计算开销就不重要，因为更好的计算方法会使得更大规模的数据处理成为可能，而做到这点则需要工程上的努力。

## 参考文献

